import React, { useRef, useState } from "react";
import { Button } from "@/components/ui/button";
import SignatureCanvas from "react-signature-canvas";
import html2canvas from "html2canvas";

export default function SignatureCapture() {
const signatureRef = useRef(null);
const [image, setImage] = useState(null);
const [photo, setPhoto] = useState(null);
const fileInputRef = useRef(null);
const [formData, setFormData] = useState({ nome: "", cpf: "", endereco: "" });

const clearSignature = () => {
signatureRef.current.clear();
};

const handleCapture = async () => {
const signatureImage = signatureRef.current.toDataURL("image/png");
const container = document.getElementById("capture-area");

if (container) {
const canvas = await html2canvas(container);
setImage(canvas.toDataURL("image/png"));
}
};

const handlePhotoUpload = (event) => {
const file = event.target.files[0];
if (file) {
const reader = new FileReader();
reader.onloadend = () => {
setPhoto(reader.result);
};
reader.readAsDataURL(file);
}
};

const handleChange = (e) => {
setFormData({ ...formData, [e.target.name]: e.target.value });
};

return (
<div className="flex flex-col items-center p-4 space-y-4 bg-gray-100 min-h-screen">
    <div id="capture-area" className="bg-white p-4 rounded-lg shadow-lg w-full max-w-lg">
        <h2 className="text-xl font-bold mb-4">Formulário</h2>
        <input type="text" name="nome" placeholder="Nome" value={formData.nome} onChange={handleChange}
            className="w-full p-2 border rounded mb-2" />
        <input type="text" name="cpf" placeholder="CPF" value={formData.cpf} onChange={handleChange}
            className="w-full p-2 border rounded mb-2" />
        <input type="text" name="endereco" placeholder="Endereço" value={formData.endereco} onChange={handleChange}
            className="w-full p-2 border rounded mb-2" />

        <h3 className="text-lg font-semibold mt-4">Assinatura</h3>
        <SignatureCanvas ref={signatureRef} penColor="black" canvasProps={{ className: "border w-full h-24 bg-gray-200"
            }} />
        <Button onClick={clearSignature} className="mt-2">Limpar Assinatura</Button>

        <h3 className="text-lg font-semibold mt-4">Foto</h3>
        <input type="file" accept="image/*" ref={fileInputRef} onChange={handlePhotoUpload}
            className="w-full p-2 border rounded mb-2" />
        {photo && <img src={photo} alt="Foto" className="mt-2 w-32 h-32 object-cover border" />}
    </div>

    <Button onClick={handleCapture} className="bg-blue-500 text-white">Capturar</Button>

    {image && (
    <div className="mt-4">
        <h3 className="text-lg font-semibold">Imagem Final</h3>
        <img src={image} alt="Captura" className="border p-2" />
    </div>
    )}
</div>
);
}